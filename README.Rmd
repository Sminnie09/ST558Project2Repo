---
title: "ST558 Project 2"
author: "Noel Hilliard"
date: "July 3, 2020"
output:
  rmarkdown::github_document:
    toc: true
params:
  day:
    NULL
---

Project Objective: The goal is to create models for predicting the `shares` variable from the dataset. You will create two models: a linear regression model and a non-linear model (each of your choice). You will use the parameter functionality of markdown to automatically generate an analysis report for each `weekday_is_*` variable (so youâ€™ll end up with seven total outputted documents).

```{r}
library(rmarkdown)
library(tidyverse)

#days of the week
days <- c("monday", "tuesday")
#"wednesday", "thursday", "friday", "saturday","sunday")

#create file names
output_file <- paste0(days, ".md")

#create a list for each day of the week with the day as parameter
params = lapply(days, FUN = function(x){list(day = x)})

#put into data frame
reports <- tibble(output_file, params)

#need to use x[[1]] to get at elements since tibble doesn't simplify
apply(reports, MARGIN = 1, FUN = function(x){
  render("S:/ST558/Homeworks/Project 2/ST558 Project 2/README.Rmd", 
         output_file = x[[1]], params = x[[2]])
})
```



# Introduction

# Online News Popularity Data

```{r, echo = TRUE, message = FALSE}

#read in data#

library(tidyverse)

newsData <-read_csv("S:/ST558/Homeworks/Project 2/ST558 Project 2/OnlineNewsPopularity.csv")
newsData$shares_group <- NA

#ifelse(newsData$shares < 1400, newsData$shares_group == "below 1400" , newsData$shares_group == "above 1400")


#split shares into 2 groups
for (i in 1:length(newsData$shares)){
  
  if(newsData$shares[i] < 1400){
    newsData$shares_group[i] <- "below 1400"
  }
  
  if(newsData$shares[i] >= 1400){
    newsData$shares_group[i] <- "above 1400"
  }
}


newsData$shares_group <- as.factor(newsData$shares_group)

#paste column name for day of week
day <- paste0('weekday_is_', params$day)

#filter for day of week
weekdayData <- filter(newsData, day == "1")
#weekdayData <- filter(newsData, weekday_is_monday == "1")
```

```{r , echo = TRUE, warning = FALSE}

#binary classification#

#initialize column for shares groups



#factor share groups


```


```{r , echo = TRUE}

#Create test/train data sets from filtered data set
set.seed(1)
train <- sample(1:nrow(weekdayData), size = nrow(weekdayData)*0.7)
test <- dplyr::setdiff(1:nrow(weekdayData), train)
weekdayDataTrain <- weekdayData[train, ]
weekdayDataTest <- weekdayData[test, ]
```

# Summary Statistics

# Modeling

## Ensemble Model: Bagged Tree


```{r , echo = TRUE, message = FALSE}
library(caret)

set.seed(1)
trCtrl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)

bag_fit <- train(shares_group ~ num_keywords + avg_positive_polarity + num_videos + num_imgs, 
                 data = weekdayDataTrain, method = "treebag", trControl = trCtrl, 
                 preProcess = c("center", "scale"))

bag_fit
```

```{r , echo = TRUE}
bag_pred <- predict(bag_fit, newdata = weekdayDataTest)

head(bag_pred)
```

```{r , echo = TRUE}
bag_fitInfo <- tbl_df(data.frame(bag_pred, weekdayDataTest$shares_group, weekdayDataTest$num_keywords, 
                                weekdayDataTest$avg_positive_polarity,
                                 weekdayDataTest$num_videos, weekdayDataTest$num_imgs))

bag_fitInfo
```

```{r , echo = TRUE}
bag_tbl <- table(bag_fitInfo$bag_pred, bag_fitInfo$weekdayDataTest.shares_group)

bag_tbl
```

```{r , echo = TRUE}
bag_misClass <- 1 - sum(diag(bag_tbl))/sum(bag_tbl)

bag_misClass
```



